<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Haxpedia</title>
    <style>
        body { background: #1a0b2e; color: white; font-family: Arial; padding: 2rem; }
        .auth-btn { background: #10b981; border: none; padding: 1rem 2rem; color: white; border-radius: 8px; cursor: pointer; }
        .team-card { background: rgba(255,255,255,0.1); padding: 1rem; margin: 1rem 0; border-radius: 8px; display: flex; align-items: center; gap: 1rem; }
        .team-logo { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; font-size: 2rem; }
        input, select, textarea { width: 100%; padding: 0.5rem; margin: 0.5rem 0; background: rgba(255,255,255,0.1); border: 1px solid #10b981; color: white; border-radius: 4px; }
        #adminPanel { display: none; background: rgba(255,255,255,0.05); padding: 2rem; border-radius: 12px; margin: 2rem 0; }
        .logo-upload { border: 2px dashed #10b981; padding: 2rem; text-align: center; cursor: pointer; border-radius: 8px; margin: 1rem 0; }
        .logo-preview { max-width: 150px; max-height: 150px; border-radius: 8px; margin: 1rem 0; }
        .submit-btn { background: #10b981; border: none; padding: 1rem 2rem; color: white; border-radius: 8px; cursor: pointer; width: 100%; }
    </style>
</head>
<body>
    <h1>Haxpedia - Haxball Ansiklopedisi</h1>
    
    <div id="auth">
        <button class="auth-btn" onclick="login()">GiriÅŸ Yap</button>
        <div id="userInfo" style="display:none;">
            <span id="userName"></span>
            <button onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>
        </div>
    </div>

    <div id="teams">
        <h2>TakÄ±mlar</h2>
        <div id="teamsList">TakÄ±mlar yÃ¼kleniyor...</div>
    </div>

    <div id="adminPanel">
        <h2>Yeni TakÄ±m Ekle</h2>
        <div id="messages"></div>
        
        <label>TakÄ±m AdÄ±:</label>
        <input id="teamName" placeholder="Ã–rn: Galatasaray HB" required>
        
        <label>Lig:</label>
        <select id="teamLeague" required>
            <option value="">Lig SeÃ§in</option>
            <option>SÃ¼per Lig</option>
            <option>1. Lig</option>
            <option>2. Lig</option>
        </select>
        
        <label>Menajeri:</label>
        <input id="teamManager" placeholder="Menajerin adÄ±">
        
        <label>TakÄ±m Logosu:</label>
        <div class="logo-upload" onclick="document.getElementById('logoInput').click()">
            <input type="file" id="logoInput" accept="image/*" style="display: none;" onchange="previewLogo(event)">
            <div id="logoPreview">
                <div style="font-size: 3rem;">ðŸ“¸</div>
                <div>Logo yÃ¼klemek iÃ§in tÄ±klayÄ±n</div>
                <div style="font-size: 0.9rem; color: #aaa;">PNG, JPG desteklenir (Max 5MB)</div>
            </div>
        </div>
        
        <button class="submit-btn" onclick="addTeam()">TakÄ±m Ekle</button>
    </div>

    <!-- Firebase SDK with Storage -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <script>
        firebase.initializeApp({
            apiKey: "AIzaSyDo0B8IIDK9Xeq4kIa3I0YK45wJS6vyzGY",
            authDomain: "haxpedia-e5054.firebaseapp.com",
            projectId: "haxpedia-e5054",
            storageBucket: "haxpedia-e5054.firebasestorage.app",
            messagingSenderId: "799081899351",
            appId: "1:799081899351:web:66943d0281fad08b910a12"
        });

        var db = firebase.firestore();
        var auth = firebase.auth();
        var storage = firebase.storage();
        var currentUser = null;
        var selectedLogo = null;

        function login() {
            var provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider);
        }

        function logout() {
            auth.signOut();
        }

        function showMessage(text, type) {
            var messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = '<div style="padding:1rem;margin:1rem 0;border-radius:8px;background:' + 
                (type === 'error' ? 'rgba(255,0,0,0.2);border:1px solid red;' : 'rgba(0,255,0,0.2);border:1px solid green;') + 
                '">' + text + '</div>';
            setTimeout(() => messagesDiv.innerHTML = '', 5000);
        }

        function previewLogo(event) {
            var file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) {
                showMessage('Logo dosyasÄ± 5MB\'dan kÃ¼Ã§Ã¼k olmalÄ±dÄ±r!', 'error');
                return;
            }
            
            if (!file.type.startsWith('image/')) {
                showMessage('Sadece resim dosyalarÄ± yÃ¼klenebilir!', 'error');
                return;
            }
            
            selectedLogo = file;
            var reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('logoPreview').innerHTML = 
                    '<img src="' + e.target.result + '" class="logo-preview" alt="Logo"><div style="color:#10b981;margin-top:1rem;">Logo hazÄ±r - ' + file.name + '</div><div style="font-size:0.9rem;color:#aaa;">DeÄŸiÅŸtirmek iÃ§in tekrar tÄ±klayÄ±n</div>';
            };
            reader.readAsDataURL(file);
        }

        function uploadLogo(file) {
            return new Promise((resolve, reject) => {
                var fileName = 'team-logos/' + Date.now() + '_' + file.name;
                var storageRef = storage.ref(fileName);
                
                var uploadTask = storageRef.put(file);
                
                uploadTask.on('state_changed', 
                    function(snapshot) {
                        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        showMessage('Logo yÃ¼kleniyor... %' + Math.round(progress), 'success');
                    },
                    function(error) {
                        reject(error);
                    },
                    function() {
                        uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                            resolve(downloadURL);
                        });
                    }
                );
            });
        }

        function addTeam() {
            if (!currentUser) return showMessage('GiriÅŸ yapÄ±n', 'error');
            if (currentUser.email !== 'evrenalbayrak96@gmail.com') return showMessage('Yetkisiz', 'error');
            
            var name = document.getElementById('teamName').value;
            var league = document.getElementById('teamLeague').value;
            var manager = document.getElementById('teamManager').value;
            
            if (!name || !league) return showMessage('TakÄ±m adÄ± ve lig zorunlu!', 'error');
            
            function saveTeam(logoURL) {
                db.collection('teams').add({
                    name: name,
                    league: league,
                    manager: manager,
                    logo: logoURL || '',
                    addedBy: currentUser.email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => {
                    showMessage('TakÄ±m baÅŸarÄ±yla eklendi!', 'success');
                    document.getElementById('teamName').value = '';
                    document.getElementById('teamLeague').value = '';
                    document.getElementById('teamManager').value = '';
                    document.getElementById('logoInput').value = '';
                    document.getElementById('logoPreview').innerHTML = '<div style="font-size: 3rem;">ðŸ“¸</div><div>Logo yÃ¼klemek iÃ§in tÄ±klayÄ±n</div>';
                    selectedLogo = null;
                    loadTeams();
                }).catch(err => {
                    showMessage('Hata: ' + err.message, 'error');
                });
            }
            
            if (selectedLogo) {
                showMessage('Logo yÃ¼kleniyor...', 'success');
                uploadLogo(selectedLogo).then(logoURL => {
                    saveTeam(logoURL);
                }).catch(err => {
                    showMessage('Logo yÃ¼kleme hatasÄ±: ' + err.message, 'error');
                });
            } else {
                saveTeam('');
            }
        }

        function loadTeams() {
            db.collection('teams').orderBy('createdAt', 'desc').get().then(snapshot => {
                var html = '';
                if (snapshot.empty) {
                    html = '<div style="text-align:center;color:#aaa;padding:2rem;">HenÃ¼z takÄ±m eklenmemiÅŸ.</div>';
                } else {
                    snapshot.forEach(doc => {
                        var team = doc.data();
                        var logoHtml = team.logo ? 
                            '<img src="' + team.logo + '" class="team-logo" alt="' + team.name + '">' : 
                            '<div class="team-logo">âš½</div>';
                        
                        html += '<div class="team-card">' + logoHtml + 
                            '<div><h3>' + team.name + '</h3><p>' + team.league + 
                            (team.manager ? ' â€¢ ' + team.manager : '') + 
                            '</p><small style="color:#aaa;">' + team.addedBy + ' tarafÄ±ndan eklendi</small></div></div>';
                    });
                }
                document.getElementById('teamsList').innerHTML = html;
            }).catch(err => {
                document.getElementById('teamsList').innerHTML = '<div style="color:red;">YÃ¼kleme hatasÄ±: ' + err.message + '</div>';
            });
        }

        auth.onAuthStateChanged(user => {
            currentUser = user;
            if (user) {
                document.getElementById('auth').innerHTML = '<span>' + user.email + '</span> <button onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>';
                if (user.email === 'evrenalbayrak96@gmail.com') {
                    document.getElementById('adminPanel').style.display = 'block';
                }
                loadTeams();
            } else {
                document.getElementById('auth').innerHTML = '<button class="auth-btn" onclick="login()">GiriÅŸ Yap</button>';
                document.getElementById('adminPanel').style.display = 'none';
                loadTeams();
            }
        });

        loadTeams();
    </script>
</body>
</html>
